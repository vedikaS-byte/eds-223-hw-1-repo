---
title: "eds-223-hw1"
format: pdf
code-fold: FALSE
message: FALSE
warning: FALSE
editor_options: 
  chunk_output_type: console
---

## Primary Objective
The state of Texas consists of 254 counties and is racially diverse. A topic of interest regarding environmental justice includes waste management impacts on communities, especially communities of color. The Environmental Justice Mapping and Screening Tool was created by the Environmental Protection Agency (EPA) to track and reveal environmental injustices based on several socioeconomic variables. The dataset was   consists of data . 

The goal of this assignment is to explore how people of color within Texas counties are significantly impacted by their proximity to toxic waste. The following research question was utilized to guide the analysis: 

**To what extent are communities in Texas counties within distance of a hazardous waste facility, especially communities of color and those within Travis County?**

## Load the appropriate packages 

```{r}
library(tidyverse) # Load the tidyverse for data cleaning
library(sf) # Load 'sf' for GIS 
library(here) # Load "here:
library(tmap)
# read in geodatabase of EJScreen data at the Census Block Group level
ejscreen <- sf::st_read(here::here("data", "ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb")) 

# filter to a state you are interested in
tx <- ejscreen %>%
  dplyr::filter(ST_ABBREV == "TX") 
```

```{r}
# filter to a county you are interested in
travis_county <- ejscreen %>%
  dplyr::filter(CNTY_NAME %in% c("Travis County"))

central_texas_summary <- tx %>%
  group_by(CNTY_NAME) %>%
  summarise(
    avg_PTSDF = mean(PTSDF, na.rm = TRUE),
    PEOPCOLORPCT = mean(PEOPCOLORPCT, na.rm = TRUE)
  )
```



## Let's make some maps

Research question: To what extent are communities in Texas counties within distance of a hazardous waste facility, especially communities of color and those within Travis County?

```{r}
#- PTSDF = hazardous waste proximity
#- D2_PTSDF = Hazardous waste proximity EJ Index
# - PEOPCOLOR: Concentrations of people of color
#- TSDF_CNT: Number of Hazardous waste facilities in the block group


tm_shape(central_texas_summary, bbox = central_texas_summary) +
  tm_polygons(
    "PEOPCOLORPCT",
    palette = "brewer.greens",
    title = "% People of Color"
  ) +
  tm_symbols(
    size = "avg_PTSDF",
    shape = 21,
    col = "blue",
    alpha = 0.7,
    size.legend = tm_legend(title = "Average Number of Hazardous Waste Facilities")
  ) +
  # tm_layout(
  #   title = "Hazardous Waste Proximity To Communities of Color in Texas Counties",
  #   legend.outside = TRUE,
  #   frame = FALSE
  # ) +
  tm_borders(col = "gray40", lwd = 0.4) +
  tm_compass(position = c("top", "right"), size = 2, type = "4star") +
  tm_scalebar(position = c("bottom", "left"), text.size = 0.7) +
  tm_graticules(
    col = "black",
    lwd = 0.3,
    alpha = 0.6 ) + 
  tm_title("Hazardous Waste Proximity To Communities of Color in Texas Counties", size = .9) +
   tm_layout(
    legend.outside = TRUE,
    #frame = FALSE
    inner.margins = c(.01,.01,.01,.2), 
    component.autoscale = FALSE)



```












```{r}
# Let's make a map of the distribution of hazardous waste facilities in the county
# tmap_mode("plot")
# #- PTSDF = hazardous waste proximity
# #- D2_PTSDF = Hazardous waste proximity EJ Index
# # - PEOPCOLOR: Concentrations of people of color
# #- TSDF_CNT: Number of Hazardous waste facilities in the block group
# # - RSEI_AIR: Toxic Releases to Air
# 
# 
# # map of concentrations of POC related to # of hazardous waste facilities in the block group 
# # nueces_id <- nueces_county %>% filter(ID == "483550005001")
# 
# #bbox <- st_bbox(travis_county)
# #expanded_bbox <- bbox + c(-5000, -5000, 5000, 5000)
# 
# 
# 
# tm_shape(central_texas) + 
#   #tm_polygons() + 
# tm_polygons("avgPOC", fill.scale = tm_scale(values = "blue"), fill.legend = tm_legend(title = "Percentage of People of Color")) + 
#   # tm_symbols(size = "PTSDF", 
#   #            title.size = "Hazardous Waste Proximity (km)",
#   #            size.legend = tm_legend(orientation = "portrait"), 
#   #            alpha = .7, shape = 21)  +
#   tm_grid(
#     col = "black", lwd = 0.5 
#   ) +
#   tm_graticules(
#     col = "black", 
#     lwd = 0.3, 
#     alpha = 0.6
#   ) + tm_compass(
#     position = c("top", "right"), 
#     size = 2
#   ) + 
#   tm_scalebar(
#     position = c("bottom", "left"), text.size = 0.7) + 
#   # tm_layout(
#   # title.size = 2)  
#   tm_title("Proximity of Hazardous Waste Facilities to POC Communities in Central Texas Counties", size = .8) + tm_layout(component.autoscale = FALSE) 
# 
# 
# 
# tm_shape(central_texas) + 
#   tm_fill() + tm_facets("CNTY_NAME") +
# tm_polygons("PEOPCOLORPCT", fill.scale = tm_scale(values = "blue"), fill.legend = tm_legend(title = "Percentage of People of Color")) + 
#   tm_symbols(size = "PTSDF", 
#              title.size = "Hazardous Waste Proximity (km)",
#              size.legend = tm_legend(orientation = "portrait"), 
#              alpha = .7, shape = 21)  +
#   tm_grid(
#     col = "black", lwd = 0.5 
#   ) +
#   tm_graticules(
#     col = "black", 
#     lwd = 0.3, 
#     alpha = 0.6
#   ) + tm_compass(
#     position = c("top", "right"), 
#     size = 2
#   ) + 
#   tm_scalebar(
#     position = c("bottom", "left"), text.size = 0.7) + 
#   # tm_layout(
#   # title.size = 2)  
#   tm_title("Proximity of Hazardous Waste Facilities to POC Communities in Central Texas Counties", size = .8) + tm_layout(component.autoscale = FALSE) 
# 
# 
# 
# 
# 
# 
# 
# library(sf)
# library(tmap)
# library(dplyr)
# library(here)
# 
# # Read EJSCREEN data
# ejscreen <- sf::st_read(here::here("data", "ejscreen", "EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb"))
# 
# # Filter for Central Texas counties
# central_texas <- ejscreen %>%
#   filter(
#     ST_ABBREV == "TX",
#     CNTY_NAME %in% c(
#       # "Bastrop County", 
#       "Bell County", 
#       #"Blanco County", "Burnet County",
#       # "Coryell County", "Gillespie County", 
#       "Hays County", 
#       #"Lampasas County",
#       # "Lee County", "Llano County", "Falls County", 
#       "McLennan County", 
#       # "Milam County", 
#       "Travis County", "Williamson County"
#     )
#   )  
# #, avg_POC = mean(PEOPCOLORPCT, na.rm = T))
# 
# # Plot faceted map
# tmap_mode("plot")
# 
# tm_shape(central_texas) +
#   tm_polygons(
#     "PEOPCOLORPCT",
#     palette = "Blues",
#     title = "Pct. People of Color"
#   ) + 
#   tm_symbols(size = "PTSDF",
#              title.size = "Hazardous Waste Proximity (km)",
#              size.legend = tm_legend(orientation = "portrait"),
#              alpha = .7, shape = 21)  +
#   tm_facets(
#     by = "CNTY_NAME",
#    # ncol = 4,             # number of columns in facet grid
#     free.coords = TRUE   # keeps all maps on same scale (set to TRUE if you want zoomed-in per county)
#   ) +
#   tm_layout(
#     title = "Percentage of People of Color in Central Texas Counties",
#     legend.outside = TRUE,
#     legend.outside.position = "right",
#     frame = FALSE
#   ) 
# 

```



## Second map 
```{r}
## hazardous waste proximity vs % low income hased on index (polygon)
tmap_mode("plot")
tm_shape(travis_county) +
  tm_polygons(
    fill = "D2_PTSDF",
    fill.scale = tm_scale(values = "brewer.reds"),
    fill.legend = tm_legend(title = "Hazardous Waste Proximity EJ Index")
  ) +
  # tm_symbols(
  #   size = "LOWINCPCT",
  #   shape = 22, 
  #   alpha = 0.6,
  #   title.size = "Low-Income Percentage"
  # ) +
   tm_graticules(
    col = "black", 
    lwd = 0.3, 
    alpha = 0.6
  ) + tm_compass(
    position = c("top", "right"), 
    size = 2
  ) + tm_grid(
    col = "black", lwd = 0.5, 
    alpha = 0.4
  ) + 
  tm_scalebar(
    position = c("bottom", "right")) + tm_graticules(
    col = "black", 
    lwd = 0.3, 
    alpha = 0.6) + 
#   tm_layout(
#     title = "Hazardous Waste Proximity EJ Index For Communities in Travis County",
#     title.size = .9,
# #    title.position = tm_pos("center"),
#     legend.outside.position = "bottom", 
#     component.autoscale = FALSE
#   ) 
  tm_title("Hazardous Waste Proximity EJ Index For Communities in Travis County", size = .9) + 
  tm_layout(inner.margins = c(.1, .1, .1, .1),  component.autoscale = FALSE)

# install.packages("tinytex")
# tinytex::install_tinytex()


```

## Interpretation

-   write a brief paragraph explaining what your maps communicate


## Data Citations



